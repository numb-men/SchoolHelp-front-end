(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/post-detail/post-detail"],{"7b8b":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=o("b575"),i={data:function(){return{showAddComment:!1,commentEnter:"",postDetail:{},post:{points:0}}},methods:{showAddCommentBox:function(){this.showAddComment=!0},hideAddCommentBox:function(){this.showAddComment=!1},goUserData:function(e){console.log(e.currentTarget.dataset.userid,this.$store.state.userInfo.id," at pages\\index\\post-detail\\post-detail.vue:98"),e.currentTarget.dataset.userId!=this.$store.state.userInfo.id&&t.navigateTo({url:"../../otherUsers/otherUsers?userId="+e.currentTarget.dataset.userid})},addComment:function(){var t=this,e=this.$api.urls.addComment,o={postId:this.post.id,commentContent:this.commentEnter};console.log(o," at pages\\index\\post-detail\\post-detail.vue:109"),this.$api.req.post(e,o,function(e){console.log(e," at pages\\index\\post-detail\\post-detail.vue:111"),t.commentEnter="",t.updateComments(),t.hideAddCommentBox()})},updateComments:function(){var t=this,e=this.$api.urls.getAllComments+this.post.id,o={};this.$api.req.get(e,o,function(e){console.log(e," at pages\\index\\post-detail\\post-detail.vue:121");var o=t.post.helpUserId,i=[];e.data&&(i=e.data.map(function(t){return{id:t.commentId,user:{id:t.userId,headImg:t.headImageUrl,isCertified:!1,name:t.commentUserName},publishTime:(0,s.friendlyDate)(new Date(t.commentTime.replace(/\-/g,"/").replace(/\T/g," ").substring(0,19)).getTime()),content:t.commentContent,helpOk:t.userId==o}}),t.post.comments=i,t.checkCertified())})},checkCertified:function(){var t=this,e=this.$api.urls.checkCertified,o=[];o.push(this.post.user.id),this.post.comments.map(function(t){o.includes(t.user.id)||o.push(t.user.id)});var s={userIds:o};console.log(s," at pages\\index\\post-detail\\post-detail.vue:153"),this.$api.req.put(e,s,function(e){for(var s in console.log(e," at pages\\index\\post-detail\\post-detail.vue:155"),o){t.post.user.id==o[s]&&(t.post.user.isCertified=e.data[s]);var i=!0,n=!1,a=void 0;try{for(var r,d=t.post.comments[Symbol.iterator]();!(i=(r=d.next()).done);i=!0){var l=r.value;l.user.id==o[s]&&(l.user.isCertified=e.data[s])}}catch(u){n=!0,a=u}finally{try{i||null==d.return||d.return()}finally{if(n)throw a}}}console.log(t.post," at pages\\index\\post-detail\\post-detail.vue:168")})},approvalPost:function(){var e=this,o=this.$api.urls.approvalPost,s={postId:this.post.id};this.$api.req.post(o,s,function(o){console.log(o," at pages\\index\\post-detail\\post-detail.vue:175"),0==o.code?(t.showToast({icon:"none",title:o.data}),"点赞成功"==o.data?e.post.approvalNum++:"取消点赞"==o.data&&e.post.approvalNum--):t.showToast({icon:"none",title:o.msg})})},reportPost:function(){var e=this,o=this.$api.urls.reportPost,s={postId:this.post.id,reportDes:"nonenonenonenonenonenonenone"};this.$api.req.post(o,s,function(o){0==o.code?(t.showToast({icon:"none",title:"举报成功"}),e.post.reportNum++):t.showToast({icon:"none",title:o.msg})})},collectPost:function(){var e=this,o=this.$api.urls.collectPost,s={postId:this.post.id};this.$api.req.post(o,s,function(o){0==o.code?(t.showToast({icon:"none",title:"收藏成功"}),e.post.collectNum++):t.showToast({icon:"none",title:o.msg})})},setHelpOk:function(e){var o=e.currentTarget.dataset.index,s=this.post.comments[o];if(console.log(o,this.post.helpUserId,this.$store.state.userInfo.id,s.user.id,this.post.user.id," at pages\\index\\post-detail\\post-detail.vue:238"),-1!=this.post.helpUserId)t.showToast({icon:"none",title:"帖子已经结贴了哦"});else if(this.$store.state.userInfo.id!=this.post.user.id)t.showToast({icon:"none",title:"非帖主不能结贴"});else if(s.user.id==this.post.user.id)t.showToast({icon:"none",title:"不能给自己设置帮助成功哦"});else if(0==this.post.points)t.showToast({icon:"none",title:"积分为0不能设置帮助成功哦"});else{var i=this;t.showModal({title:"设置帮助成功",content:"您确定选择"+s.user.name+"帮助成功回答吗？他将获得所有帖子积分。",success:function(e){if(e.confirm){var o=i.$api.urls.submitPost,n={postId:i.post.id,submitCommentId:s.id};i.$api.req.post(o,n,function(e){t.showToast({title:"结贴成功！"}),i.getPostDetail()})}}})}},getPostDetail:function(){var t=this,e=this.$api.urls.getPostDetail+this.postDetail.postId,o={};this.$api.req.get(e,o,function(e){console.log(e," at pages\\index\\post-detail\\post-detail.vue:289");var o=e.data.post.helpUserId,i=[];e.data.comments&&(i=e.data.comments.map(function(t){return{id:t.commentId,user:{id:t.userId,headImg:t.headImageUrl,isCertified:!1,name:t.commentUserName},publishTime:(0,s.friendlyDate)(new Date(t.commentTime.replace(/\-/g,"/").replace(/\T/g," ").substring(0,19)).getTime()),content:t.commentContent,helpOk:t.userId==o}}));var n=e.data.post;t.post={id:n.postId,user:{id:n.userId,headImg:n.headImageUrl,isCertified:!1,name:n.userName},title:n.title,content:n.content,publishTime:(0,s.friendlyDate)(new Date(n.issueTime.replace(/\-/g,"/").replace(/\T/g," ").substring(0,19)).getTime()),points:n.points,comments:i,viewNum:n.viewNum,approvalNum:n.approvalNum,commentNum:n.commentNum,reportNum:n.reportNum,helpUserId:n.helpUserId,helpOk:-1!=n.helpUserId},t.checkCertified()})}},onPullDownRefresh:function(){this.getPostDetail(),setTimeout(function(){t.stopPullDownRefresh()},1e3)},onLoad:function(t){for(var e in this.postDetail=JSON.parse(t.query),this.postDetail)console.log(e,"---",this.postDetail[e]," at pages\\index\\post-detail\\post-detail.vue:343");this.getPostDetail()}};e.default=i}).call(this,o("6e42")["default"])},"8d92":function(t,e,o){"use strict";o.r(e);var s=o("7b8b"),i=o.n(s);for(var n in s)"default"!==n&&function(t){o.d(e,t,function(){return s[t]})}(n);e["default"]=i.a},"971b":function(t,e,o){"use strict";o.r(e);var s=o("ecd5"),i=o("8d92");for(var n in i)"default"!==n&&function(t){o.d(e,t,function(){return i[t]})}(n);o("f1a6");var a=o("2877"),r=Object(a["a"])(i["default"],s["a"],s["b"],!1,null,"1eba24bd",null);e["default"]=r.exports},ecd5:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return i})},f1a6:function(t,e,o){"use strict";var s=o("f84d"),i=o.n(s);i.a},f84d:function(t,e,o){}},[["4168","common/runtime","common/vendor"]]]);